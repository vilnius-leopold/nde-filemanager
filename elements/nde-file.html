<template>
	<style type="text/css">

		*{
			padding: 0;
			margin: 0;
			border: none;
			outline: none;
			box-sizing: border-box;
			font-size: 0;
			line-height: 0;
		}
		#file{
			/*float: left;*/
			display: block;
			width: 150px;
			height: 150px;
			position: relative;
			cursor: pointer;
		}
		#container{
			width: 150px;
			height: 150px;
			min-height: 150px;
			border: 1px solid transparent;
			padding: 10px;
			position: absolute;
			border-radius: 2px;
		}
		#image-wrapper{
			height: 64px;
			overflow: hidden;
			margin-bottom: 4px;
			text-align: center;
			vertical-align: middle;
		}
		img{
			height: 100%;
		}
		#text-wrapper{
			overflow: hidden;
			height: 60px;
			color: #ddd;
		}
		p{
/*			text-align: center;
			line-height: 20px;
			font-size: 15px;
			word-wrap: break-word;
			font-family: sans-serif;
			color: #333;*/
			/*background: #ffeeee;*/
			display: block; /* Fallback for non-webkit */
			display: -webkit-box;
			max-width: 128px;
			/*height: 60px;  Fallback for non-webkit */
			font-family: sans-serif;
			margin: 0 auto;
			text-align: center;
			font-size: 15px;
			line-height: 20px;
			word-wrap: break-word;
			-webkit-line-clamp: 3;
			-webkit-box-orient: vertical;
			overflow: hidden;
			text-overflow: ellipsis;
			color: #333;
		}
		#file:hover #container,#file:hover #text-wrapper{
			height: auto;
		}
		#file:hover #container{
			background: white;
			border-color: #ddd;
			box-shadow: 0 2px 6px -3px rgba(0,0,0,0.3);
			z-index: 500;
		}
		#file:hover p{
			/*color: black;*/
			-webkit-line-clamp: initial;
		}
	</style>
	<div id="file">
		<div id="container">
			<div id="image-wrapper">
				<img src="">
			</div>
			<div id="text-wrapper">
				<p><content></content></p>
			</div>
		</div>
	</div>
</template>

<script>
	(function(window, document, undefined) {
		// Refers to the "importer", which is index.html
		var thatDoc = document;

		// Refers to the "importee", which is src/hello-world.html
		var thisDoc =  (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;

		// Gets content from <template>
		var template = thisDoc.querySelector('template').content;

		// Creates an object based in the HTML Element prototype
		var MyElementProto = Object.create(HTMLElement.prototype);

		// Creates the "icon" attribute and sets a default value
		MyElementProto.icon = 'folder';

		console.log('SHADOW ELEMNT:', MyElementProto);

		var shadowRoot;

		function getRandomInt(min, max) {
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}

		// Fires when an instance of the element is created
		MyElementProto.createdCallback = function() {
			// Creates the shadow root
			shadowRoot = this.createShadowRoot();

			// Adds a template clone into shadow root
			var clone = thatDoc.importNode(template, true);
			shadowRoot.appendChild(clone);

			// Caches <strong> DOM query
			this.img = shadowRoot.querySelector('img');
			this.container = shadowRoot.querySelector('#container');
			this.p   = shadowRoot.querySelector('p');

			this.p.textContent = this.textContent;

			if ( ! this.hasAttribute('async') )
				this.hide();

			// Checks if the "who" attribute has been overwritten
			if (this.hasAttribute('icon')) {
				var icon = this.getAttribute('icon');
				this.setIcon(icon);
			}
			else {
				this.setIcon(this.icon);
			}
		};
		// Fires when an instance of the element is created
		MyElementProto.attachedCallback = function() {
			// Creates the shadow root
			this.p   = shadowRoot.querySelector('p');

			this.p.textContent = this.textContent;

			if ( ! this.hasAttribute('async') ) {
				this.hide();
			} else {
				this.show();
			}
		};
		// Fires when an attribute was added, removed, or updated
		MyElementProto.attributeChangedCallback = function(attr, oldVal, newVal) {
			console.log('Attribute change:', attr, oldVal, newVal);

			if (attr === 'icon') {
				this.setIcon(newVal);
			}

			if (attr === 'name') {
				this.setName(newVal);
			}
		};
		MyElementProto.show = function() {
			this.container.style.display = 'block';
		};
		MyElementProto.hide = function() {
			this.container.style.display = 'none';
		};
		// Sets new value to "icon" attribute
		MyElementProto.setIcon = function(val) {
			this.icon = val;

			var image = this.img;

			image.onload = function(){
				if ( this.onload ) {
					this.onload(this);
				} else if ( ! this.hasAttribute('async') ) {
					this.show();
				}
			}.bind(this);

			// setTimeout(function(){
				image.src = this.icon;
			// }.bind(this), getRandomInt(0,500));
		};
		MyElementProto.setName = function(val) {
			this.name = val;
			this.p.textContent = val;
		};
		// Registers <hello-world> in the main document
		window.MyElement = thatDoc.registerElement('nde-file', {
			prototype: MyElementProto
		});
	})(window, document);
</script>